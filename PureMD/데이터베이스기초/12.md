# todo=

er diagram review

전체적 review



이제 DB가 어케 설계,만들어지는 지 알므.

1.문제 발생

- 요구사항 정의

	- from 고객

- >명세서

2.문제 해결

- 응용프로그램 설계

	- 보통 요즘 응용프로그램은 DB와 연동이라.

- DB 설계

>둘이 꽤 유사..?

 >UML?

>예전엔 프로그램이 직접 했는데

 >파일 시스템에 '직접' 연결...

3.DB 설계

- ER diagram 생성.

	- 옜날-스타일, 책에서 사용.

	- 신 crow fit 방식.

	- 둘이 대충 동등하긴 함.

- DB schema 로.

- 정규화

	- DB 스키마가 '최적'인지 검증하는 거?

	- 이 뒤에 바로 DB에 table 만들면 됨.



# ERD 과제

## ERD 그리는 법

문제?명세서? 갖고 diagram을 그리는 거



1.명사 추출

- problom domain entry?

	- entity 가 될 가능성이 있는 모든 거.

2.분류

### -소거법

1.너무 크기가 큰 명사

- ex:이 시스템은 ...

2.중복되는거.

- 학생=사용자인데 중복이면 둘 중 하나로 통일하기.

3.애매모호한거

4.너무 작은 단위인거

- 학생.이름/학과/주소/...

	- 이건 걍 학생 entity의 필드로 묶어야.

### -선택법

entity가 될만한 거 뽑아내기.

1.후보 뽑기

사람/사물/장소/사건/거래/...

등이 후보.

2.고정적 정보를 유지하는 명ㅇ사?

학생.이름/학번은 안바뀜.

거래/사건은 잘 바뀜.



이제 고정적 정보를 가진 명사를 먼저 배치



동사를 가지고 관계를 삽입.



그거 갖고 속성도 찾아냄

- 명사/형용사



이제 이게 엔티티?속성?을 결정?



여러 번의 조정을 걸쳐..?



>공식화 안됨..

>휴리스틱?



>내 mermaid 어디감..???



## 1.택배회사

ref github



나중에 생각해 보면 값이 1개만 있을게 뻔한 튜플은 필요 없겠네?



>설계에 대한 답은 다 최적인 건 아님..?

 >국을의 경우도.



## 2.컨설턴트

컨설턴트가 2종이 있음..

상근/그냥

- ER diagram에선 표현 ㅂㄱㄴ?

UML에선 그런 상속?관계가 표현됨.



잘 바뀌는/아닌 정보가 있음.

entity는 잘 안바뀌는 정보가 들어가고,

관계가 들어가는 부분은 잘바뀜..?

- 한 곳이 바뀐다고 다른 곳이 안바뀌게 '잘'..?



시험에 나온다고 해도 전체적 개념의 이해가 더 중요..?



## 4.대학교

...

교수님 취향은 attr 보다는 객체랑 관계를 main으로 하시네..?

attr은 정규화 뒤에나 나오는 건가..?





@review

# ER 모델

우리 목표는 논리적 스키마(DB 스키마)임



## ER 스키마->관계 모델.릴레이션

기본 원칙은 엔티티 하나마다 table 하나.

약한 엔티티는 외래 키+자기 값->pk

### 2진 1:1 관계

한쪽이 다른 쪽의 PK를 참조하게 하거나

관계 (서로의 PK를 저장)만 저장하는 table 하나 만들기

아예 table을 병합하거나



정규화 과정에서 어느 게 가장 좋을지 결정?

### 1:N 관계

N 쪽인 애들 table이

1인 쪽 pk로 가리키게.





자기가 자기 자신에계 관계를?

- 저 이진 1:1에서 병합만 빼고.



m:n 관계

- 양쪽의 pk를 합쳐 pk로 쓰게 하는

- 관계 전용니 거.



### 3진 관계

>좋은 모델링이 아님...

>문제 이해에 필요하다면 어쩔수 없지만...

### 다치 애트리뷰트

따로 table으로 떼서

원본?을 pk로 가리키게.





@re-review

# 외부자료-DB.설계.ER 모델링

데이터 모델링 단계

..?



요구사항을 str 명세서를 잘 받는게 중요.

- 안혼동스럽게 해야 근거로 확인 ㄱㄴ.



객체 도출?

- 명사로

관계 도출?

- 동사로

- 하지만 ERD에선 명사화해서 적는 거 추천.



객체	|관계	|???



용어가 많이 중요..?

- 불필요한/애매한 표현은 잘 제거하기.



개체 변환?



1:다 관계

- ㄷ비식별 식?

\\<-- !졺 -->
!졺





정규화가 항상 최적은 아님

효율성이 갖아 중요.



# 정규화



수정 이상?

- 만복된 데타 중 일부만 수정하면 불일치가 생기는 경우

삽입/삭제 이상

- 불필욯나 정보 삭제/추가 안하고는 update가 ㅂㄱㄴ



## 릴레이션 분해

다시 join시키면 원래대로 되돌릴 수 있을 때만.

분해를 잘못하면

정보가 원래보다 더/덜 ...

'함수적 종속성'에 대한 이해를 바탕으로

## 관계 db.설계.비공식적 지침

1.이해하기 쉽고 명확한 스키마 를 만들어라.

2.널 피하기



## 함수적 종속성

결정자

- A에 대해 고유하게 B 하나를 대응시킬 수 있으면

- A가 B의 결정자..?

- ex:PK는 다른 모든 attr의 결정자.

A가 B의 결정자면

B는 A에게 함수적으로 종속한다.



### 완전 함수적 종속성

B가 A에 함수적 종속이면서

A의 어떤 진부분 집합에(모든 부분집합 -self)도 

함수적으로 종속하지 않으면

애트리뷰트 B가 애트리뷰트 B에게 환전하게 함수적으로 종속한다고 함.

>그러니까 A에는 종속이지만

>A에서 뭐라도 빼면 종속 안하는 경우.



A가 복합 attr일때만 성립.

>못나누면 성립 못함.

### 이행적 함수적 종속성

A->B and B->C면

A->C

면

C는 A에게 이행적으로 종속.

종속하면서 이행적 종속할 수도.



@partial

## 릴레이션 분해

무손실 분해!

- 정보가 늘거나 줄거나 둘 다 안됨.



>키 말고 다른 것끼리의 종속 하게는 안좋음..?



사실 미친 척 하고 pk를 기준으로 모든 attr을 나눌 수 있음.

- 항상 분해가 좋은 건 아님.

### 나쁜 분해-가짜 튜플

자연 조인 후에 튜플이 더 생김...

안좋음.

### 제 1 정규형

=모든 attr의 애트리뷰트가 원자값만을 갖는다.



즉,list를 가질 수는 없음...

관계 DB면 기본적으로 만족.



제 1 정규형으로 바꾸기?

- pk를 기준으로 분할..?

- 아니면 걍 duplecate?



ex:

pk(학번,과목번호)

학과이름

학과전번

학점



수정 이상

- 학과의 소속 학생 수 만큼 학과 전번이 중복되서

- 학과 전번이 바뀌었을 때 학과 소속 모든 학생의 튜플에서

- 전번을 수정해야...

삽입 이상

- 학과에 학생이 없으면 학과 생성 ㅂㄱㄴ..

삭제이상

- 마지막 학생 삭제하면 학과 정보도 증발.





문제-정보가 섞여 있어서!



갱신 이상의 이유?

- 기본 키에 대한 부분 함수적 종속성이 학생 릴레이션에 있어서.



학번-과목번호가 PK인데

학번->학과이름,학과전번

인 부분 함수적 종속성이 있어서...



### 제 2 정규형

=1 정규형이고

후보 키가 아닌 모든 attr이

R의 기본키에 완전히 함수적으로 종속해야.

>즉,부분 함수형 종속성 없어야.



기본 키가 1개의 속성이면

그냥 제 2 정규형을 만족함.



#### 학번1

pk(학번)

학과이름

학과전번

#### 수강

pk(학번,과목번호)

학점



갱신 이상

- 아직도 전번 변경시 모든 학생 수정해야...

이상들이 아직 그대로...



문제 이유?

이행적 종속성!

학과 이름<->학과 전화번호

학번->학과이름



이거 땜시 갱신 이상이...

이제

{pk(학번) 학과이름}

{pk(학과이름) 학과전화번호}

로 나누기.

### 제 3 정규형

=제 2 정규형이고

키가 아닌 모든 attr이

기본 키에 이행적으로 종속하지 않는 것.



#### 수강

pk(학번,과목)

강사

강사는 한 과목만 가르친다고 하면

에서

이상한 함수형 종속성들이 존재함

(학번,과목)->강사

강사->과목



키가 아닌데도 결정자인 경우도..?



수정 이상

- 강사 변경시 모든 학생 튜플에서 숮어해야...

삽입 이상

- 과목의 수강생이 없으면

- 강사 정보 입력이 ㅂㄱㄴ.

- 학번이 기본 키라 null을 못넣음..

삭제 이상

- 이수하는 학생 1명인데 학생 삭제하면

- 강사 정보도 삭제



이유?

- 키도 아닌 것이

- 다른 애트리뷰트를 결정해서.

- 후보 키의 존재?

	- (학번,과목),(학번,강사) 2개

### BCNF

=제 3 정규형아고

모든 결정자가 후보 키여야..??



제 3이면 웬만해선 BCNF

제 3이 후보 키가 단 하나면 자동 BCNF



제 3->BCNF 하려면

키 아닌데도 결정자인거랑

거기에 함수적 종속인 attr을 한 테이블에 넣음

거기서 결정자가 기본 키가 됨.



기존 릴레이션에선 결정자만 남겨 기본 키의 일부가 되게 함..?



- 새 릴레이션에 대한 외래키 역할도 함.







### 역정규화

정규화가 진행될수록...

- 중복 감소

- 갱신 이상 감소

- 무결성 제약요건 check를 위한 코드 양 감소

대신

- join 회수 증가->성능 감소...



웬만한 경우에서 검색이 갱신보다 더 자주임..

- 역정규화는 빈번히 수행되는 질의들의 수행 속도를 높이려고

- 이미 분해된 거 재조립하는 거.

# 뷰와 시스템 카탈로그

>이전에 DB 3단계 구조에서

>뷰라는 말이 나왔..는데 그거랑은 다른 거임..??

>외부 뷰랑 다름..?

>그건 시스템-DB를 사용자에 따라 보여주는 거고

>얘는 가상-table을 만드는 거고..



뷰.역할?

- DB의 보안 메커니즘

- 복잡한 질의를 간단히 표현

- 데이터 독립성 높이기 위애

>그냥 프로퍼티잖아?

 >보안,복잡한거 간단히,독립성 다 해당이네..?



시스템 카탈로그

- 메타데이터가 저장되는 곳.

- 시스템 내의 객체 정보

	- 기본 리레이션,뷰,인덱스,사용자,접근 권한 등...

- 이거 갖고 원하는 릴레이션을 



## 뷰.개요

가상-릴레이션=table을 만듦.

기존 릴레이션에 대한 SELECT문의 형태로 정의됨.

여러 릴레이션,뷰 사용 가능.

뷰를 통해 검색/갱신이 가능한

동적인 창 역할.



>완전 property...

## 스냅샷

어떤 시점의 SELECT문의 결과를

기본 릴레이션의 형태로 저장해 놓은 것.



일반적으로는 DB 상태는 계속 변하지남

스냅샷은 사진 찍은 것처럼

스냅샷 정의 시점의 내용이 반영.

## 뷰.정의

```sql

CREAT VIEW Vname [attr1,attr2,...]

AS SELECT ...



[WITH CHECK OPTION]

```

[] 안은 생략 가능.

생략하면

SELECT한거 전체가.



생략 안하면 SELECT한 거 이름을

순서대로 이거로...?



불가능한 경우도..?

- select에서 SUM,AVERAGE,...

 등을 사용해서 만들어진 attr이 존재

- 2+개 릴레이션을 join했는데

 이름 겹치는 경우가 있으면 모든 attr 이름 지정해야.

## 뷰.예제

두 릴레이션 위에서 뷰 적용할 수도!

## 뷰.구현

사실은 DBMS에서 뷰 생성하는 쿼리를

인라이닝해서 구현함.

- 시스템 카탈로그에서 검색해서.

>완전 프로퍼티네..

## 뷰.장점

복잡한 쿼리를 간단하게.

데이터 무결성 보장에도?

- WICH CHECK OPTION을 켜야.

- update를 하려고 해도 

 기존의 select from 문의 조건에 안맞으면 거부됨.

데이터 독립성 제공

- getter-setter네;;

- DB의 구조가 바뀌어도 기존의 질의를 다시 작성할 필요성 줄이는데 사용.

- ex:기존의 EMPLOYEE 릴레이션이

	- EMP1,EMP2로 분할됬다고 해도

	- 합친 EMPLOYEE 뷰를 다시 정의하면 기존의 SELECt문 다 사용 ㄱㄴ.

데이터 보안 기능.

- 특정(뷰에서 적용하는)정보만 접근 허용!

## 뷰.갱신

이것도 기본 릴레이션에 대한 갱신으로 inline됨.

불가능한 경우

- 기본 키 접근이 ㅂㄱㄴ한 경우

- NOT NULL인 애트리뷰트에 접근이 ㅂㄱㄴ한 경우

- 집단함수/조인이 있는 뷰



보통 사용자가 정의 가능한 뷰 >

이론적으로 갱신 가능한 뷰 >

상용 관계 DBMS가 갱신 허용하는 뷰



순으로 범위 감소?

## 시스템 카탈로그

DB에 대한 data임.

DB의 모든 객체에 대한 정보 잇음.

'메타데이터'. 데이터에 관한 데이터.

DBMS에 의해 사용됨

- 사용자 권한 확인, 질의 최적화,...

표준적인 물건이 아님.

- DBMS by DBMS.



='data dictionary'='system table'

## 시스템 카탈로그.질의 처리

SELECT문의 문법적 정확성

참조하는 릴레이션이 있는 건가?

저 나온 attr이 존재 하는 건가?

저 수식에 type이 맞는 건가?



사용자가 권한이 있나?

저 릴레이션들의 인덱스 정의된게 있나?

- 일종의 캐시?메모이즈?

	- 순서를 미리 찾아놓은 거.



어느 순서로 처리해야 가장 빠를까?

- 여러 == 가 있을 때 어느 거 먼저 수행이 유리할까?

- 범위를 더 많이 좁히는 게 어느 ==인가?

- 등등..





### 질의 최적화?

가장 비용이 적은 방법을 DBMS가 알아서 '잘' 찾음

시스템 카탈로그 정ㅂ ㅗ갖고.

## 시스템 카탈로그.시스템 카탈로그

사욪자 릴레이션과 마찬가지 형태로 저장됨.

- 회복 기법,동시성 제어 기법을 동일하게 사용 ㄱㄴ..?

여기서도 쿼리 가능!

하지만 직접 수정은 절대 불가능.

- DELECT UPDATE INSERT...

ALTER TABLE EMPLOYEE DROP COLUMN MANAGER;

처럼은 되지만



### 시스템.카탈로그.통계 정보?



릴레이션의

- 튜플 크기,수,채우기 비율?블록킹 인수?

- 릴레이션 크기(=블록 수?)

뷰 이름,정의

애트리뷰트의 data type,size

상이한 값 개수

값 범위

선택율?









과제-월~화 쯤에 낼거임

- 집에서 각자 컴터에 sql 설치하고

- 쿼리 해서 결과 내보기..?

- ~화요일

- 블로그에 제출하기.

